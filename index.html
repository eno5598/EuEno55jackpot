<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eurojackpot‚ÄëSystemtool</title>
    <!-- JSZip zum Entpacken des Archivs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <style>
        /* Grundlegendes Layout */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #333;
        }
        h1 {
            background: #004a7c;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            padding: 20px;
            max-width: 1100px;
            margin: auto;
        }
        #status {
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeeba;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        #info p {
            margin: 0 0 5px 0;
        }
        #controls, #systemTip {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        label {
            display: inline-block;
            margin-right: 10px;
        }
        input[type="number"] {
            padding: 4px;
            width: 80px;
        }
        button {
            padding: 6px 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background: #a0c4ff;
            cursor: not-allowed;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            margin-bottom: 10px;
        }
        .number-box {
            text-align: center;
            padding: 8px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            background: #f9f9f9;
        }
        .number-box.selected {
            background: #007bff;
            color: white;
            font-weight: bold;
        }
        #hotCold {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .hotcold-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .hotcold-section div {
            flex: 1;
            margin-right: 10px;
        }
        .hotcold-section div:last-child {
            margin-right: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 5px;
            text-align: center;
        }
        th {
            background: #e9ecef;
        }
        .analysis-table {
            margin-top: 10px;
        }
        .analysis-table th {
            background: #dff0d8;
        }
        .emoji-label {
            margin-right: 5px;
        }
    </style>
</head>
<body>
<h1>Eurojackpot‚ÄëSystemtool</h1>
<div class="container">
    <div id="status">üì¶ Lade Archiv‚Ä¶</div>

    <div id="info" style="display: none;">
        <div id="controls">
            <p>üé≤ <strong>Anzahl Ziehungen:</strong> <span id="drawCount"></span></p>
            <p>üìÖ <strong>Letzte Ziehung:</strong> <span id="lastDate"></span></p>
            <label for="lastX">üîÑ <strong>Ziehungen analysieren:</strong></label>
            <input type="number" id="lastX" min="1" placeholder="alle">
            <button id="updateBtn">Aktualisieren</button>
        </div>
        <div id="hotCold">
            <h2>üî• Hei√ü &amp; üßä Kalt</h2>
            <div class="hotcold-section">
                <div>
                    <h3>H√§ufigste Zahlen (Hauptzahlen)</h3>
                    <ul id="hotMain"></ul>
                </div>
                <div>
                    <h3>Seltendste Zahlen (Hauptzahlen)</h3>
                    <ul id="coldMain"></ul>
                </div>
            </div>
            <div class="hotcold-section">
                <div>
                    <h3>H√§ufigste Eurozahlen</h3>
                    <ul id="hotEuro"></ul>
                </div>
                <div>
                    <h3>Seltendste Eurozahlen</h3>
                    <ul id="coldEuro"></ul>
                </div>
            </div>
        </div>
        <div id="systemTip">
            <h2>üéüÔ∏è Systemtipp</h2>
            <p>W√§hlen Sie zwischen <strong>5‚Äë11</strong> Hauptzahlen und <strong>2‚Äë12</strong> Eurozahlen (keine normalen 5/2‚ÄëTipps).</p>
            <div>
                <strong>Hauptzahlen:</strong>
                <div id="numbersGrid" class="grid"></div>
            </div>
            <div>
                <strong>Eurozahlen:</strong>
                <div id="euroGrid" class="grid"></div>
            </div>
            <p><strong>Anzahl Spiele:</strong> <span id="numGames">0</span></p>
            <p><strong>Preis:</strong> <span id="price">0,00&nbsp;‚Ç¨</span></p>
            <button id="analyzeTipBtn" disabled>Analyse durchf√ºhren</button>
        </div>
        <div id="analysisResult" style="display: none;">
            <h2>üîç Analyse Ihres Tipps</h2>
            <div id="analysisSummary"></div>
            <div id="analysisTables"></div>
        </div>
    </div>
</div>

<script>
    // Hilfsfunktionen f√ºr Kombinationen
    function nCr(n, r) {
        if (r > n || r < 0) return 0;
        if (r === 0 || r === n) return 1;
        let num = 1;
        let den = 1;
        for (let i = 0; i < r; i++) {
            num *= (n - i);
            den *= (i + 1);
        }
        return num / den;
    }

    // Globaler Zustand
    let draws = [];
    let filteredDraws = [];
    let mainFreq = {};
    let euroFreq = {};
    let selectedMain = new Set();
    let selectedEuro = new Set();

    // Aktualisiert die Preise und aktiviert/ deaktiviert den Analyse‚ÄëButton
    function updateSystemPrice() {
        const mainCount = selectedMain.size;
        const euroCount = selectedEuro.size;
        const numGamesEl = document.getElementById('numGames');
        const priceEl = document.getElementById('price');
        const analyzeBtn = document.getElementById('analyzeTipBtn');

        if (mainCount >= 5 && euroCount >= 2 && (mainCount > 5 || euroCount > 2)) {
            const combinations = nCr(mainCount, 5) * nCr(euroCount, 2);
            const price = combinations * 2;
            numGamesEl.textContent = combinations.toLocaleString('de-DE');
            priceEl.textContent = price.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '\u00A0‚Ç¨';
            analyzeBtn.disabled = false;
        } else {
            numGamesEl.textContent = '0';
            priceEl.textContent = '0,00\u00A0‚Ç¨';
            analyzeBtn.disabled = true;
        }
    }

    // Erstellt Auswahlrasters f√ºr Zahlen
    function createNumberGrid() {
        const numbersGrid = document.getElementById('numbersGrid');
        const euroGrid = document.getElementById('euroGrid');
        // Hauptzahlen (1‚Äì50)
        for (let i = 1; i <= 50; i++) {
            const box = document.createElement('div');
            box.className = 'number-box';
            box.textContent = i;
            box.dataset.value = i;
            box.addEventListener('click', () => {
                const value = parseInt(box.dataset.value);
                if (selectedMain.has(value)) {
                    selectedMain.delete(value);
                    box.classList.remove('selected');
                } else {
                    if (selectedMain.size < 11) { // Maximal 11 Hauptzahlen
                        selectedMain.add(value);
                        box.classList.add('selected');
                    }
                }
                updateSystemPrice();
            });
            numbersGrid.appendChild(box);
        }
        // Eurozahlen (1‚Äì12)
        for (let i = 1; i <= 12; i++) {
            const box = document.createElement('div');
            box.className = 'number-box';
            box.textContent = i;
            box.dataset.value = i;
            box.addEventListener('click', () => {
                const value = parseInt(box.dataset.value);
                if (selectedEuro.has(value)) {
                    selectedEuro.delete(value);
                    box.classList.remove('selected');
                } else {
                    if (selectedEuro.size < 12) { // Maximal 12 Eurozahlen
                        selectedEuro.add(value);
                        box.classList.add('selected');
                    }
                }
                updateSystemPrice();
            });
            euroGrid.appendChild(box);
        }
    }

    // Berechnet Frequenzen der Zahlen in filteredDraws
    function calculateFrequencies() {
        mainFreq = {};
        euroFreq = {};
        for (let i = 1; i <= 50; i++) mainFreq[i] = 0;
        for (let i = 1; i <= 12; i++) euroFreq[i] = 0;
        filteredDraws.forEach(draw => {
            draw.main.forEach(n => { mainFreq[n]++; });
            draw.euro.forEach(n => { euroFreq[n]++; });
        });
    }

    // Erstellt Listen der hei√üesten und k√§ltesten Zahlen
    function updateHotCold() {
        calculateFrequencies();
        const hotMainList = document.getElementById('hotMain');
        const coldMainList = document.getElementById('coldMain');
        const hotEuroList = document.getElementById('hotEuro');
        const coldEuroList = document.getElementById('coldEuro');

        function createList(freqObj, listEl, ascending) {
            const entries = Object.entries(freqObj);
            entries.sort((a, b) => ascending ? a[1] - b[1] : b[1] - a[1]);
            listEl.innerHTML = '';
            const slice = entries.slice(0, 10); // Zeige Top 10
            slice.forEach(([num, count]) => {
                const li = document.createElement('li');
                li.textContent = num + ': ' + count + '√ó';
                listEl.appendChild(li);
            });
        }
        createList(mainFreq, hotMainList, false); // Hot: absteigend
        createList(mainFreq, coldMainList, true); // Cold: aufsteigend
        createList(euroFreq, hotEuroList, false);
        createList(euroFreq, coldEuroList, true);
    }

    // Analyse des Tipps durchf√ºhren
    function analyzeTip() {
        const analysisDiv = document.getElementById('analysisResult');
        const summaryDiv = document.getElementById('analysisSummary');
        const tablesDiv = document.getElementById('analysisTables');
        summaryDiv.innerHTML = '';
        tablesDiv.innerHTML = '';
        analysisDiv.style.display = 'block';

        // Tippdaten
        const mainNumbers = Array.from(selectedMain).sort((a,b) => a - b);
        const euroNumbers = Array.from(selectedEuro).sort((a,b) => a - b);

        // H√§ufigkeit der einzelnen Zahlen
        const mainCounts = mainNumbers.map(n => ({ num: n, count: mainFreq[n] || 0 }));
        const euroCounts = euroNumbers.map(n => ({ num: n, count: euroFreq[n] || 0 }));

        // Vorkommen des gesamten Tipps
        let fullMatches = 0;
        const matchDates = [];
        filteredDraws.forEach(draw => {
            // √úberpr√ºfe, ob alle ausgew√§hlten Zahlen in der Ziehung enthalten sind
            const mainMatch = mainNumbers.every(n => draw.main.includes(n));
            const euroMatch = euroNumbers.every(n => draw.euro.includes(n));
            if (mainMatch && euroMatch) {
                fullMatches++;
                matchDates.push(draw.date);
            }
        });

        // Zusammenfassung
        const summaryP = document.createElement('p');
        summaryP.innerHTML = 'üéØ Sie haben <strong>' + mainNumbers.join(', ') + '</strong> und Eurozahlen <strong>' + euroNumbers.join(', ') + '</strong> gew√§hlt.';
        summaryDiv.appendChild(summaryP);
        const occurrenceP = document.createElement('p');
        occurrenceP.innerHTML = '‚è±Ô∏è Dieser Tipp kam in den ausgew√§hlten Ziehungen <strong>' + fullMatches + '</strong> mal exakt vor.';
        summaryDiv.appendChild(occurrenceP);
        if (fullMatches > 0) {
            const datesP = document.createElement('p');
            datesP.textContent = 'Datum(e): ' + matchDates.join(', ');
            summaryDiv.appendChild(datesP);
        }

        // Tabelle der einzelnen Zahlen
        const mainTable = document.createElement('table');
        mainTable.className = 'analysis-table';
        let tr = document.createElement('tr');
        ['Hauptzahl', 'H√§ufigkeit'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            tr.appendChild(th);
        });
        mainTable.appendChild(tr);
        mainCounts.forEach(item => {
            const row = document.createElement('tr');
            const cell1 = document.createElement('td');
            cell1.textContent = item.num;
            const cell2 = document.createElement('td');
            cell2.textContent = item.count;
            row.appendChild(cell1);
            row.appendChild(cell2);
            mainTable.appendChild(row);
        });
        const euroTable = document.createElement('table');
        euroTable.className = 'analysis-table';
        tr = document.createElement('tr');
        ['Eurozahl', 'H√§ufigkeit'].forEach(text => {
            const th = document.createElement('th');
            th.textContent = text;
            tr.appendChild(th);
        });
        euroTable.appendChild(tr);
        euroCounts.forEach(item => {
            const row = document.createElement('tr');
            const cell1 = document.createElement('td');
            cell1.textContent = item.num;
            const cell2 = document.createElement('td');
            cell2.textContent = item.count;
            row.appendChild(cell1);
            row.appendChild(cell2);
            euroTable.appendChild(row);
        });
        tablesDiv.appendChild(mainTable);
        tablesDiv.appendChild(euroTable);
    }

    // Ziehungen einlesen und UI initialisieren
    async function loadArchive() {
        const statusEl = document.getElementById('status');
        // Versuche, die ZIP-Datei √ºber mehrere Proxies herunterzuladen
        const archiveUrl = 'https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip';
        const proxies = [
            'https://cors.isomorphic-git.org/',
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            ''
        ];
        let arrayBuffer = null;
        for (const proxy of proxies) {
            const url = proxy ? proxy + archiveUrl : archiveUrl;
            try {
                statusEl.textContent = '‚è≥ Lade Archiv √ºber ' + (proxy || 'direkte URL') + ' ‚Ä¶';
                const resp = await fetch(url);
                if (!resp.ok) throw new Error('HTTP ' + resp.status);
                arrayBuffer = await resp.arrayBuffer();
                break;
            } catch (e) {
                console.warn('Fehler beim Laden √ºber', proxy, e);
                arrayBuffer = null;
            }
        }
        if (!arrayBuffer) {
            // Fallback: versuche lokale Datei aus demselben Verzeichnis zu laden
            try {
                statusEl.textContent = '‚ö†Ô∏è Fallback: Lade lokale Datei ‚Ä¶';
                const resp = await fetch('archiv_eurojackpot.zip');
                if (!resp.ok) throw new Error('Lokaler Download fehlgeschlagen');
                arrayBuffer = await resp.arrayBuffer();
            } catch (e) {
                statusEl.textContent = '‚ùå Archiv konnte nicht geladen werden.';
                console.error('Archiv konnte nicht geladen werden:', e);
                return;
            }
        }
        statusEl.textContent = 'üìÇ Entpacke Archiv ‚Ä¶';
        const zip = await JSZip.loadAsync(arrayBuffer);
        const file = zip.file(/eurojackpot\.txt/i)[0];
        if (!file) {
            statusEl.textContent = '‚ùå eurojackpot.txt nicht im Archiv gefunden.';
            return;
        }
        const content = await file.async('string');
        parseDraws(content);
        statusEl.style.display = 'none';
        document.getElementById('info').style.display = 'block';
        createNumberGrid();
        document.getElementById('updateBtn').addEventListener('click', () => {
            const lastXInput = document.getElementById('lastX');
            let n = parseInt(lastXInput.value);
            if (isNaN(n) || n <= 0) {
                filteredDraws = [...draws];
            } else {
                filteredDraws = draws.slice(-n);
            }
            updateHotCold();
        });
        document.getElementById('analyzeTipBtn').addEventListener('click', analyzeTip);
        // Standard: alle Ziehungen
        filteredDraws = [...draws];
        updateHotCold();
    }

    // Parsen der eurojackpot.txt
    function parseDraws(text) {
        const lines = text.trim().split(/\r?\n/);
        // Erste Zeile = Header
        lines.shift();
        draws = lines.map(line => {
            const parts = line.split(/\t+/);
            const [tag, monat, jahr, a1, a2, a3, a4, a5, b1, b2] = parts;
            const date = [jahr.padStart(4, '0'), monat.padStart(2,'0'), tag.padStart(2,'0')].join('-');
            return {
                date: date,
                main: [a1, a2, a3, a4, a5].map(n => parseInt(n, 10)).sort((x,y) => x - y),
                euro: [b1, b2].map(n => parseInt(n, 10)).sort((x,y) => x - y)
            };
        });
        // Metadaten aktualisieren
        document.getElementById('drawCount').textContent = draws.length;
        document.getElementById('lastDate').textContent = draws[draws.length - 1].date;
    }

    // Beim Laden der Seite starten
    window.addEventListener('DOMContentLoaded', loadArchive);
</script>
</body>
</html>